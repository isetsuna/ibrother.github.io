---
layout: post
title: "jekyll-6"
description: 
headline: 
modified: 2014-12-16
category: personal
tags: []
image: 
  feature: 
comments: true
mathjax: 
---

经过前五篇的洗礼，第六篇我们来给jekyll默认模板加上评论功能，添加评论功能有什么好处呢？评论和留言功能利用了人性中的傲慢，可以帮助你引入社交流量。

其中静态博客蛋疼的地方就是评论功能，不过我们可以用第三方评论系统，这里我们以多说为例。

在这之前默认的模板是没有js的，本篇是我们第一次添加js到模板里。开工之前，默认你已经有多说的short name了。下面开始干活！

首先我们在主配置文件里加上下面这行代码来定义多说的short name，其中`xxoo`为你的多说short name。

```
duoshuo_shortname:  xxoo
```

接下来我们在`_includes`目录下创建一个文件名为`duoshuo_comments.html`的文件，内容如下所示：

```html
<script type="text/javascript">
var duoshuoQuery = {short_name:"{{ site.duoshuo_shortname: }}"};
        (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0] 
                 || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
</script>
```

这段代码就是从多说通用代码里剥离出来的，并用我们定义的变量来替换short name。

然后我们在`_includes`目录下面再创建一个名为`scripts.html`的文件，这个文件可以专门用来放引用的js。内容如下：

```html
{% if page.comments %}{% include duoshuo_comments.html %}{% endif %}
```

这段代码的意思就是如果我们在文章或者页面的头信息里加了`comment:`，那么`scripts.html`就去把`duoshuo_comments.html`的内容包含进来。

接下来要怎么做呢？接下来我们需要在`_layouts/default.html`里include `scripts.html`

并加上下面的代码：

```html
{% if site.duoshuo_shortname and page.comments == true %}<div class="ds-thread" data-thread-key="{{ page.id }}" data-title="{{ page.title }}" data-url="{{ site.url }}{{ page.url }}"></div><!-- /#duoshuo_thread -->{% endif %}
```

其中多说评论的参数用jekyll模板的变量替代了，为什么要把多说的<div>和js代码分开呢，因为<div>可以控制多说出现在页面的位置，js放到页面下面可以加快页面载入速度。

最终我们可以看到`_layouts/default.html`的代码为下面的样子：

```html
<!DOCTYPE html>
<html>

  {% include head.html %}

  <body>

    {% include header.html %}

    <div class="page-content">
      <div class="wrapper">
        {{ content }}
      </div>
    </div>

    {% if site.duoshuo_shortname and page.comments == true %}<div class="ds-thread" data-thread-key="{{ page.id }}" data-title="{{ page.title }}" data-url="{{ site.url }}{{ page.url }}"></div>{% endif %}
    {% include footer.html %}
    {% include scripts.html %}

  </body>

</html>
```

现在博客的目录结构是下面的样子:

```
|- about.md
|
|- _config.yml
|
|- css-|
|      |- main.scss
|
|- feed.xml
|
|- _includes-|
|            |- footer.html
|            |- header.html
|            |- head.html
|            |- duoshuo_comments.html
|            |- scripts.html
|
|- _layouts-|
|           |- default.html
|           |- page.html
|           |- post.html
|
|- _posts-|
|         |- 2014-12-15-welcome-to-jekyll.markdown
|         |- 2014-12-16-welcome-to-coderq.md
|
|- _sass-|
|        |- _base.scss
|        |- _layout.scss
|        |- _syntax-highlighting.scss
|
|- _site
```

接着我只在欢迎来到码农圈这篇文章加入了`comments: true`的头信息，评论显示成功(没改样式的画面太美)，其余两篇文章评论关闭成功！

至此我们成功给默认模板加入多说评论，并实现了单独开关评论的功能
